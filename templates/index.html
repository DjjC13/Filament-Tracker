<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Filament Tracker</title>
  <link rel="icon" type="image/svg+xml" href="/static/Favicon.svg">
  <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
  <header class="topbar">
    <div class="topbar-left">
      <div class="title">Filament Tracker</div>
    </div>
    <div class="topbar-right">
      <button id="btnAdd" class="btn primary">+ Add Spool</button>
      <button id="btnQuote" class="btn">Quote Print</button>
      <a class="btn" href="/logout">Logout</a>
    </div>
  </header>

  <main class="wrap">
    <section class="card hero">
      <div class="hero-left">
        <p class="eyebrow">Live Inventory HUD</p>
        <h1>Filament Command Center</h1>
        <p class="muted hero-copy">
          Monitor spool health, owners, and checkout activity with a neon control room built for busy print farms.
        </p>
      </div>
      <div class="hero-stats">
        <div class="stat">
          <div class="stat-label">Total Spools</div>
          <div class="stat-value" id="statTotal">--</div>
          <div class="stat-meta">Active in vault</div>
        </div>
        <div class="stat">
          <div class="stat-label">Avg Remaining</div>
          <div class="stat-value" id="statAvg">--%</div>
          <div class="stat-meta">Fleet health</div>
        </div>
        <div class="stat">
          <div class="stat-label">Checked Out</div>
          <div class="stat-value" id="statCheckedOut">--</div>
          <div class="stat-meta">Borrowed now</div>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="row space">
        <div>
          <h2>Spools</h2>
          <p class="muted small">Search, update, and quote from every filament spool you own.</p>
          <!-- <div class="muted small">Location is the ownerâ€™s name. Checkout is tracked separately.</div>-->
        </div>
        <div class="row search-bar">
          <input id="search" class="input" placeholder="Search..." />
          <button id="btnRefresh" class="btn">Refresh</button>
        </div>
      </div>

      <div id="spoolList" class="list"></div>
    </section>
  </main>

  <!-- Add/Edit Modal -->
  <div id="modalAdd" class="modal">
    <div class="modal-content card">
      <div class="row space">
        <h2>Add Spool</h2>
        <button class="btn ghost" data-close="modalAdd">Close</button>
      </div>

      <form id="addForm" class="grid two">
        <label>
          Name (brand + color, etc.)
          <input name="name" required placeholder="e.g. Polymaker PLA Pro - Black" />
        </label>

        <label>
          Material
          <select name="material" required>
            {% for m in material_types %}
              <option value="{{ m }}">{{ m }}</option>
            {% endfor %}
          </select>
        </label>

        <label>
          Color Name
          <input name="colorName" required placeholder="e.g. Black" />
        </label>

        <label>
          Color (hex)
          <div class="row">
            <input name="colorHex" id="colorHex" required value="#000000" />
            <input type="color" id="colorPicker" value="#000000" />
          </div>
        </label>

        <label>
          Spool Material
          <select name="spoolMaterial" required>
            <option>Cardboard</option>
            <option>Plastic</option>
            <option>None</option>
          </select>
        </label>

        <label>
          Spool Outside Diameter (mm)
          <input name="spoolODmm" type="number" step="1" min="0" required value="200" />
        </label>

        <label>
          Spool Width (mm)
          <input name="spoolWidthmm" type="number" step="1" min="0" required value="70" />
        </label>

        <label>
          Owner (Home Location)
          <select name="owner" required>
            {% for u in users %}
              <option value="{{ u }}">{{ u }}</option>
            {% endfor %}
          </select>
        </label>

        <label>
          Initial Weight (g) (filament only)
          <input name="initialG" type="number" step="0.1" min="0.1" required value="1000" />
        </label>

        <label>
          Used (g)
          <input name="usedG" type="number" step="0.1" min="0" required value="0" />
        </label>

        <label>
          Price (CAD)
          <input name="price" type="number" step="0.01" min="0" required value="30.00" />
        </label>

        <label>
          Birth Date (date entered)
          <input name="birthDate" id="birthDate" type="date" />
        </label>

        <div class="row" style="grid-column: 1 / -1; justify-content: flex-end;">
          <button class="btn primary" type="submit">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Quote Modal -->
  <div id="modalQuote" class="modal">
    <div class="modal-content card">
      <div class="row space">
        <h2>Quote Print</h2>
        <button class="btn ghost" data-close="modalQuote">Close</button>
      </div>

      <form id="quoteForm" class="grid two">
        <label>
          Spool
          <select id="quoteSpool" name="spoolId" required></select>
        </label>

        <label>
          Proposed Print Weight (g)
          <input name="proposedG" type="number" step="0.1" min="0.1" required value="50" />
        </label>

        <div class="row" style="grid-column: 1 / -1; justify-content: flex-end;">
          <button class="btn primary" type="submit">Calculate</button>
        </div>
      </form>

      <div id="quoteResult" class="quoteResult"></div>
    </div>
  </div>

  <script>
    window.APP_META = {
      materialTypes: {{ material_types|tojson }},
      users: {{ users|tojson }},
    };
  </script>
  <script>
    // default birth date = today
    document.addEventListener("DOMContentLoaded", () => {
      const d = new Date();
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth() + 1).padStart(2, "0");
      const dd = String(d.getDate()).padStart(2, "0");
      const el = document.getElementById("birthDate");
      if (el) el.value = `${yyyy}-${mm}-${dd}`;
    });
  </script>
  <script src="/static/app.js"></script>
</body>
</html>
